{% extends 'app/base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}
{% block description %}Manage messages sent through the contact form with Gmail-like interface.{% endblock %}
{% block keywords %}inbox, messages, contact, management, admin{% endblock %}

{% block content %}
<section class="section contact">
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-3 col-md-4">
                <div class="inbox-sidebar">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-inbox-fill me-2"></i>
                                Message Inbox
                            </h5>

                            <!-- Compose button (future feature) -->
                            <div class="d-grid mb-3">
                                <button class="btn btn-primary" disabled>
                                    <i class="bi bi-plus-circle me-2"></i>
                                    Compose (Coming Soon)
                                </button>
                            </div>

                            <!-- Folder Navigation -->
                            <div class="inbox-folders">
                                <ul class="list-unstyled">
                                    <li class="folder-item">
                                        <a href="?filter=all" class="folder-link {% if current_filter == 'all' %}active{% endif %}">
                                            <i class="bi bi-inbox me-3"></i>
                                            All Messages
                                            <span class="badge bg-info ms-auto">{{ total_messages }}</span>
                                        </a>
                                    </li>
                                    <li class="folder-item">
                                        <a href="?filter=unread" class="folder-link {% if current_filter == 'unread' %}active{% endif %}">
                                            <i class="bi bi-envelope me-3"></i>
                                            Unread
                                            <span class="badge bg-info ms-auto">{{ unread_count }}</span>
                                        </a>
                                    </li>
                                    <li class="folder-item">
                                        <a href="?filter=read" class="folder-link {% if current_filter == 'read' %}active{% endif %}">
                                            <i class="bi bi-envelope-open me-3"></i>
                                            Read
                                            <span class="badge bg-success ms-auto">{{ read_count }}</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>

                            <!-- Quick Stats -->
                            <div class="inbox-stats mt-4">
                                <h6 class="text-muted">Quick Stats</h6>
                                <div class="stat-item">
                                    <small class="text-muted">Total Messages:</small>
                                    <strong class="float-end">{{ total_messages }}</strong>
                                </div>
                                <div class="stat-item">
                                    <small class="text-muted">Unread:</small>
                                    <strong class="float-end text-warning">{{ unread_count }}</strong>
                                </div>
                                <div class="stat-item">
                                    <small class="text-muted">Read:</small>
                                    <strong class="float-end text-success">{{ read_count }}</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9 col-md-8">
                <div class="inbox-main">
                    <!-- Toolbar -->
                    <div class="inbox-toolbar">
                        <div class="card">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-5">
                                        <!-- Search -->
                                        <div class="search-container">
                                            <form method="get" id="search-form" class="d-flex">
                                                <div class="input-group">
                                                    <input type="text" name="search" class="form-control"
                                                        placeholder="Search messages..."
                                                        value="{{ search_query }}" id="search-input">
                                                    <input type="hidden" name="filter" value="{{ current_filter }}">
                                                    <button class="btn btn-secondary" type="submit">
                                                        <i class="bi bi-search"></i>
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <!-- Bulk Actions -->
                                        <div class="bulk-actions d-flex justify-content-end">
                                            <div class="btn-group" role="group">
                                                <button type="button"
                                                        class="btn btn-sm btn-secondary"
                                                        id="select-all-btn">
                                                    <i class="bi bi-check-square"></i>
                                                    Select All
                                                </button>
                                                <button type="button"
                                                        class="btn btn-sm btn-primary"
                                                        id="mark-read-btn"
                                                        disabled>
                                                    <i class="bi bi-envelope-open"></i>
                                                    Mark Read
                                                </button>
                                                <button type="button"
                                                        class="btn btn-sm btn-warning"
                                                        id="mark-unread-btn"
                                                        disabled>
                                                    <i class="bi bi-envelope"></i>
                                                    Mark Unread
                                                </button>
                                                <button type="button"
                                                        class="btn btn-sm btn-danger"
                                                        id="delete-selected-btn"
                                                        disabled>
                                                    <i class="bi bi-trash"></i>
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Messages List -->
                    <div class="inbox-content" id="inbox-content">
                        {% include 'app/contact/inbox_content.html' %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Message Detail Modal -->
<div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div id="modal-content-container">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="loading-overlay" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'assets/js/inbox.js' %}"></script>
{% endblock %}
