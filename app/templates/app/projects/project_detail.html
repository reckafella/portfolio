{% extends "app/base.html" %}
{% load static %}
{% block title %}{{ project.title }}{% endblock %}

{% block content %}
<section id="section" class="mt-5 section projects bg-light">
    <div class="container bg-white col-lg-8 col-md-10 col-sm-12">
        <div class="card bg-white mx-auto" style="max-width: 100%;" data-aos="fade-up" data-aos-delay="200">
            <div class="card-header text-center">
                <div class="info-wrap mb-3" data-aos="fade-up">
                    <div class="d-flex justify-content-between">
                        <small class="text-muted text-center">
                            <a href="{% url 'app:projects' %}" class="text-decoration-none p-2 text-danger" title="Go back to Projects">
                                <i class="bi bi-arrow-left-square"></i> Projects
                            </a>
                        </small>
                        <h2 class="fw-bold">{{ project.title }}</h2>
                        <!-- Icon for editing -->
                        {% if user.is_staff  %}
                        <a href="{% url 'app:update_project' project.id %}" class="btn btn-link text-decoration-none text-primary">
                            <i class="bi bi-pencil-square bi-pencil-fill"></i>
                        </a>
                        {% endif %}
                    </div>
                    <p class="card-text">
                        <small class="text-muted">
                            Created on {{ project.created_at | date:"N j, Y" }}
                            {% if project.updated_at and project.updated_at != project.created_at %}
                                &nbsp; | &nbsp; Last Updated: {{ project.updated_at | date:"N j, Y" }}
                            {% endif %}
                        </small>
                    </p>

                    {% if user.is_staff %}
                    <div class="action-buttons mb-2">
                        <a href="{% url 'app:update_project' project.id %}" class="btn btn-sm btn-primary">Edit Project</a>
                        <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                            Delete Project
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="card-body">
                <!-- Project Cover Image -->
                {% if project.optimized_image_url %}
                <img src="{{ project.optimized_image_url }}" class="img-fluid mb-4 project-hero-image" alt="{{ project.title }}" style="width: 100%; max-height: 500px; object-fit: cover; border-radius: 10px;">
                {% endif %}

                <!-- Project Description -->
                <div class="text-start project-description">
                    <h4 class="mb-3 text-center">Project Overview</h4>
                    {{ project.description | safe }}
                </div>

                <!-- Project Links -->
                <div class="project-links mt-4 d-flex justify-content-center">
                    {% if project.project_url %}
                    <a href="{{ project.project_url }}" target="_blank" class="btn btn-outline-success">
                       <span class="mx-1">Visit Project</span><i class="bi bi-link-45deg"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Related Projects Section -->
        {% if related_projects %}
        <div class="mt-5">
            <h3 class="text-center mb-4">Explore More Projects</h3>
            <div class="row">
                {% for related_project in related_projects %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card bg-white h-100 project-card" data-aos="fade-up" data-aos-delay="200">
                        {% if related_project.optimized_image_url %}
                        <img src="{{ related_project.optimized_image_url }}" class="card-img-top" alt="{{ related_project.title }}" style="height: 200px; object-fit: cover;">
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">
                                <a href="{% url 'app:project_detail' related_project.id %}" class="text-success text-decoration-none">
                                    {{ related_project.title }}
                                </a>
                            </h5>
                            <p class="card-text text-muted">
                                <small>{{ related_project.created_at | date:"N j, Y" }}</small>
                            </p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Delete Confirmation Modal -->
    {% if user.is_staff %}
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete the project "{{ project.title }}"? This action cannot be undone.
                </div>
                <div class="modal-footer">
                    <form action="{% url 'app:delete_project' project.id %}" method="post" class="d-flex justify-content-between">
                        {% csrf_token %}
                        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</section>
{% endblock %}
