<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tags Validator Demo</title>
    <link rel="stylesheet" href="app/static/assets/css/form-validation.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .demo-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .demo-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .demo-header h1 {
            color: #333;
            margin: 0 0 10px 0;
        }
        .demo-header p {
            color: #666;
            margin: 0;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #007cba;
        }
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        .demo-section h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        .demo-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .demo-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        .btn-primary {
            background: #007cba;
            color: white;
        }
        .btn-primary:hover {
            background: #005a8a;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #545b62;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .config-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .test-case {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #007cba;
            background: #f8f9fa;
        }
        .test-case strong {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }
        .current-tags {
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>üè∑Ô∏è Tags Validator Demo</h1>
            <p>Test comprehensive validation for comma-separated tags with configurable rules</p>
        </div>

        <form id="tags-demo-form">
            <!-- Basic Tags Field -->
            <div class="demo-section">
                <h3>Basic Tags Field</h3>
                <div class="form-group">
                    <label for="id_basic_tags">Tags (Basic Validation)</label>
                    <input type="text" id="id_basic_tags" name="basic_tags" 
                           placeholder="web, design, frontend, javascript">
                    <div id="id_basic_tags-feedback" class="feedback"></div>
                    <div class="current-tags" id="basic-tags-display"></div>
                </div>
                <div class="config-display" id="basic-config"></div>
            </div>

            <!-- Strict Tags Field -->
            <div class="demo-section">
                <h3>Strict Tags Field</h3>
                <div class="form-group">
                    <label for="id_strict_tags">Tags (Strict Validation)</label>
                    <input type="text" id="id_strict_tags" name="strict_tags" 
                           placeholder="Only 2-5 tags, 3-20 chars each, no duplicates">
                    <div id="id_strict_tags-feedback" class="feedback"></div>
                    <div class="current-tags" id="strict-tags-display"></div>
                </div>
                <div class="config-display" id="strict-config"></div>
            </div>

            <!-- Required Tags Field -->
            <div class="demo-section">
                <h3>Required Tags Field</h3>
                <div class="form-group">
                    <label for="id_required_tags">Tags (Required)</label>
                    <input type="text" id="id_required_tags" name="required_tags" 
                           placeholder="At least 1 tag required">
                    <div id="id_required_tags-feedback" class="feedback"></div>
                    <div class="current-tags" id="required-tags-display"></div>
                </div>
                <div class="config-display" id="required-config"></div>
            </div>

            <!-- Test Cases -->
            <div class="demo-section">
                <h3>Test Cases</h3>
                <div class="test-case">
                    <strong>Valid Tags:</strong>
                    <code>web, design, frontend, javascript, react</code>
                </div>
                <div class="test-case">
                    <strong>Too Many Tags:</strong>
                    <code>tag1, tag2, tag3, tag4, tag5, tag6, tag7, tag8, tag9, tag10, tag11</code>
                </div>
                <div class="test-case">
                    <strong>Duplicate Tags:</strong>
                    <code>web, design, web, frontend, design</code>
                </div>
                <div class="test-case">
                    <strong>Invalid Characters:</strong>
                    <code>web, design<script>, "quoted tag", frontend</code>
                </div>
                <div class="test-case">
                    <strong>Too Short/Long:</strong>
                    <code>a, verylongtagnamethatshouldnotbeallowed, web</code>
                </div>
                <div class="test-case">
                    <strong>Empty Tags:</strong>
                    <code>web, , design, , frontend</code>
                </div>

                <div class="demo-actions">
                    <button type="button" onclick="testValidTags()">Test Valid</button>
                    <button type="button" onclick="testTooManyTags()">Test Too Many</button>
                    <button type="button" onclick="testDuplicates()">Test Duplicates</button>
                    <button type="button" onclick="testInvalidChars()">Test Invalid Chars</button>
                    <button type="button" onclick="testLength()">Test Length</button>
                    <button type="button" onclick="testEmpty()">Test Empty</button>
                    <button type="button" onclick="clearAll()">Clear All</button>
                </div>
            </div>

            <!-- Manual Actions -->
            <div class="demo-section">
                <h3>Manual Actions</h3>
                <div class="demo-actions">
                    <button type="button" onclick="addTag()">Add Tag</button>
                    <button type="button" onclick="removeTag()">Remove Tag</button>
                    <button type="button" onclick="formatTags()">Format Tags</button>
                    <button type="button" onclick="showTags()">Show Tags Array</button>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <input type="text" id="manual-tag-input" placeholder="Tag to add/remove">
                </div>
            </div>
        </form>
    </div>

    <script type="module">
        import { FormManager } from './app/static/assets/javascript/forms/manager/FormManager.js';
        import { TagsValidator } from './app/static/assets/javascript/forms/validators/TagsValidator.js';

        // Field configurations for different validation scenarios
        const fieldConfigs = {
            'id_basic_tags': {
                required: false,
                minTags: 1,
                maxTags: 10,
                minTagLength: 2,
                maxTagLength: 30,
                allowDuplicates: true,
                invalidCharsPattern: /[<>\"'&]/
            },
            'id_strict_tags': {
                required: false,
                minTags: 2,
                maxTags: 5,
                minTagLength: 3,
                maxTagLength: 20,
                allowDuplicates: false,
                invalidCharsPattern: /[<>\"'&@#$%^*()]/
            },
            'id_required_tags': {
                required: true,
                minTags: 1,
                maxTags: 8,
                minTagLength: 2,
                maxTagLength: 25,
                allowDuplicates: false,
                invalidCharsPattern: /[<>\"'&]/
            }
        };

        // Initialize form manager
        const formManager = new FormManager('tags-demo-form', fieldConfigs);
        const tagsValidator = new TagsValidator(formManager);

        // Register validators
        formManager.registerValidator('id_basic_tags', () => tagsValidator.validate('id_basic_tags'));
        formManager.registerValidator('id_strict_tags', () => tagsValidator.validate('id_strict_tags'));
        formManager.registerValidator('id_required_tags', () => tagsValidator.validate('id_required_tags'));

        // Setup fields
        formManager.setupFields();

        // Display configurations
        document.getElementById('basic-config').textContent = JSON.stringify(fieldConfigs['id_basic_tags'], null, 2);
        document.getElementById('strict-config').textContent = JSON.stringify(fieldConfigs['id_strict_tags'], null, 2);
        document.getElementById('required-config').textContent = JSON.stringify(fieldConfigs['id_required_tags'], null, 2);

        // Update tags display
        function updateTagsDisplay() {
            ['id_basic_tags', 'id_strict_tags', 'id_required_tags'].forEach(fieldId => {
                const tags = tagsValidator.getTags(fieldId);
                const displayId = fieldId.replace('id_', '').replace('_', '-') + '-display';
                document.getElementById(displayId).textContent = `Tags: [${tags.map(t => `"${t}"`).join(', ')}] (${tags.length})`;
            });
        }

        // Add event listeners to update display
        ['id_basic_tags', 'id_strict_tags', 'id_required_tags'].forEach(fieldId => {
            document.getElementById(fieldId).addEventListener('input', updateTagsDisplay);
        });

        // Test functions
        window.testValidTags = () => {
            document.getElementById('id_basic_tags').value = 'web, design, frontend, javascript, react';
            tagsValidator.validate('id_basic_tags');
            updateTagsDisplay();
        };

        window.testTooManyTags = () => {
            document.getElementById('id_strict_tags').value = 'tag1, tag2, tag3, tag4, tag5, tag6, tag7, tag8';
            tagsValidator.validate('id_strict_tags');
            updateTagsDisplay();
        };

        window.testDuplicates = () => {
            document.getElementById('id_strict_tags').value = 'web, design, web, frontend, design';
            tagsValidator.validate('id_strict_tags');
            updateTagsDisplay();
        };

        window.testInvalidChars = () => {
            document.getElementById('id_basic_tags').value = 'web, design<script>, "quoted tag", frontend';
            tagsValidator.validate('id_basic_tags');
            updateTagsDisplay();
        };

        window.testLength = () => {
            document.getElementById('id_strict_tags').value = 'ab, verylongtagnamethatshouldnotbeallowed, web';
            tagsValidator.validate('id_strict_tags');
            updateTagsDisplay();
        };

        window.testEmpty = () => {
            document.getElementById('id_required_tags').value = 'web, , design, , frontend';
            tagsValidator.validate('id_required_tags');
            updateTagsDisplay();
        };

        window.clearAll = () => {
            ['id_basic_tags', 'id_strict_tags', 'id_required_tags'].forEach(fieldId => {
                document.getElementById(fieldId).value = '';
                tagsValidator.validate(fieldId);
            });
            updateTagsDisplay();
        };

        // Manual actions
        window.addTag = () => {
            const tagInput = document.getElementById('manual-tag-input');
            if (tagInput.value.trim()) {
                tagsValidator.addTag('id_basic_tags', tagInput.value.trim());
                tagInput.value = '';
                updateTagsDisplay();
            }
        };

        window.removeTag = () => {
            const tagInput = document.getElementById('manual-tag-input');
            if (tagInput.value.trim()) {
                tagsValidator.removeTag('id_basic_tags', tagInput.value.trim());
                tagInput.value = '';
                updateTagsDisplay();
            }
        };

        window.formatTags = () => {
            ['id_basic_tags', 'id_strict_tags', 'id_required_tags'].forEach(fieldId => {
                tagsValidator.formatTags(fieldId);
            });
            updateTagsDisplay();
        };

        window.showTags = () => {
            const basicTags = tagsValidator.getTags('id_basic_tags');
            const strictTags = tagsValidator.getTags('id_strict_tags');
            const requiredTags = tagsValidator.getTags('id_required_tags');
            
            alert(`Basic Tags: ${JSON.stringify(basicTags)}\nStrict Tags: ${JSON.stringify(strictTags)}\nRequired Tags: ${JSON.stringify(requiredTags)}`);
        };

        // Initial display update
        updateTagsDisplay();
    </script>
</body>
</html>
